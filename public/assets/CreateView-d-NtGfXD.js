import{d as C,r as m,l as I,K as V,c as f,a as t,t as D,e as R,x as $,z as g,A as w,u as B,f as c,i as q,g as E,h as _,o as v,T as x,n as A,L as j,_ as M}from"./index-DjZ0-uLA.js";const N={class:"page"},z={class:"content"},K={key:0,class:"loading"},L={key:1},F={class:"card"},G={key:0,class:"mb-md"},H={class:"form-group"},J={class:"form-group"},O={class:"d-flex gap-sm justify-end"},P=["disabled"],Q=C({__name:"CreateView",setup(W){const n=B(),h=m(!0),u=m(!1),s=m(null),y=n.currentRoute.value.query.templateId,b=n.currentRoute.value.query.type,r=m({title:"",description:""}),T=async()=>{var l,e,a,p;if(!y||!c.currentUser){n.push("/dashboard");return}try{const d=b==="private"?`users/${c.currentUser.uid}/projectTemplates`:"publishedTemplates",i=await q(E(_,d,y));if(!i.exists()){console.error("テンプレートが見つかりません"),n.push("/dashboard");return}const o=i.data();b==="private"?s.value={...o,id:i.id,createdAt:(l=o.createdAt)==null?void 0:l.toDate(),updatedAt:(e=o.updatedAt)==null?void 0:e.toDate()}:s.value={...o,id:i.id,publishedAt:(a=o.publishedAt)==null?void 0:a.toDate(),updatedAt:(p=o.updatedAt)==null?void 0:p.toDate()}}catch(d){console.error("テンプレート取得エラー:",d)}finally{h.value=!1}},U=()=>{s.value=null,r.value={title:"",description:""}},k=async()=>{if(!(!c.currentUser||!s.value)){u.value=!0;try{const l={userId:c.currentUser.uid,templateId:s.value.id,templateType:b,title:r.value.title,description:r.value.description,createdAt:x.now().toDate(),updatedAt:x.now().toDate(),status:"in_progress"},e=A(_,`users/${c.currentUser.uid}/projects`),a=await j(e,l),p=s.value.steps;for(const d of p){const i={templateStepId:d.id,order:d.order,conversations:[],stepState:{generatedChoices:[]},documents:d.referenceDocuments.map(S=>({id:S.id,isEnabled:!0})),uploadedDocuments:[]},o=A(_,`users/${c.currentUser.uid}/projects/${a.id}/steps`);await j(o,i)}n.push(`/project/${a.id}`)}catch(l){console.error("プロジェクト作成エラー:",l),alert("プロジェクトの作成に失敗しました")}finally{u.value=!1}}};return I(T),V(()=>{!h.value&&!s.value&&n.push("/dashboard")}),(l,e)=>(v(),f("div",N,[e[5]||(e[5]=t("header",{class:"header"},[t("h1",null,"新規プロジェクト作成")],-1)),t("div",z,[h.value?(v(),f("div",K," 読み込み中... ")):(v(),f("div",L,[t("section",null,[t("div",{class:"d-flex justify-between align-center mb-md"},[e[2]||(e[2]=t("h2",null,"プロジェクト情報入力",-1)),t("button",{class:"btn btn-text",onClick:U}," テンプレート選択に戻る ")]),t("div",F,[s.value?(v(),f("h3",G,"選択中のテンプレート: "+D(s.value.title),1)):R("",!0),t("form",{onSubmit:$(k,["prevent"]),class:"form"},[t("div",H,[e[3]||(e[3]=t("label",{for:"title"},"プロジェクト名",-1)),g(t("input",{id:"title","onUpdate:modelValue":e[0]||(e[0]=a=>r.value.title=a),type:"text",required:"",class:"form-control",placeholder:"プロジェクト名を入力"},null,512),[[w,r.value.title]])]),t("div",J,[e[4]||(e[4]=t("label",{for:"description"},"説明",-1)),g(t("textarea",{id:"description","onUpdate:modelValue":e[1]||(e[1]=a=>r.value.description=a),class:"form-control",rows:"3",placeholder:"プロジェクトの説明を入力"},null,512),[[w,r.value.description]])]),t("div",O,[t("button",{type:"submit",class:"btn btn-primary",disabled:u.value},D(u.value?"作成中...":"作成"),9,P)])],32)])])]))])]))}}),Y=M(Q,[["__scopeId","data-v-7ff56d1c"]]);export{Y as default};
